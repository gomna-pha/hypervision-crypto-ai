<!DOCTYPE html>
<html>
<head>
    <title>Clustering Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body>
    <div id="debug"></div>
    <div id="result"></div>
    
    <script>
        const debug = document.getElementById('debug')
        const result = document.getElementById('result')
        
        debug.innerHTML = 'Starting test...<br>'
        
        async function testClustering() {
            try {
                debug.innerHTML += 'Calling /api/asset-clustering...<br>'
                const response = await axios.get('/api/asset-clustering')
                debug.innerHTML += 'Response received<br>'
                
                if (response.data && response.data.clustering) {
                    const data = response.data.clustering
                    debug.innerHTML += `Data loaded: ${data.totalAssets} assets<br>`
                    debug.innerHTML += `Assets array: ${data.assets ? data.assets.length : 'undefined'}<br>`
                    
                    // Calculate average correlation like in the main app
                    let totalCorrelation = 0
                    let correlationCount = 0
                    
                    if (data.assets) {
                        data.assets.forEach(asset1 => {
                            if (asset1.correlations) {
                                data.assets.forEach(asset2 => {
                                    if (asset1.symbol !== asset2.symbol && asset1.correlations[asset2.symbol] !== undefined) {
                                        totalCorrelation += Math.abs(asset1.correlations[asset2.symbol])
                                        correlationCount++
                                    }
                                })
                            }
                        })
                        
                        const avgCorrelation = correlationCount > 0 ? totalCorrelation / correlationCount : 0
                        
                        result.innerHTML = `
                            <h3>Clustering Test Results:</h3>
                            <p>Total Assets: ${data.totalAssets}</p>
                            <p>Assets Array Length: ${data.assets.length}</p>
                            <p>Average Correlation: ${avgCorrelation.toFixed(3)}</p>
                            <p>Correlation Count: ${correlationCount}</p>
                        `
                    }
                } else {
                    debug.innerHTML += 'ERROR: Invalid data structure<br>'
                }
            } catch (error) {
                debug.innerHTML += `ERROR: ${error.message}<br>`
            }
        }
        
        // Run test on page load
        testClustering()
    </script>
</body>
</html>